# -*- coding: utf-8 -*-
"""
模块名称: constants.py
模块功能: 定义客户端程序的所有常量和可配置项
依赖模块: 无（纯Python标准库）
系统适配: 所有平台通用

说明:
    本模块集中管理所有配置项，支持外部修改无需改动代码。
    配置项分为以下几类：
    1. 服务端通信配置
    2. 心跳与重试配置
    3. 资源限制阈值
    4. 日志配置
    5. 授权相关配置
"""

# =============================================================================
# 服务端通信配置
# =============================================================================

# 服务端API基础地址，用户可根据实际部署情况修改
SERVER_URL = "http://127.0.0.1:82/safe"  # 服务端API地址，格式: http(s)://host:port/path

# 注册接口路径，客户端首次运行时调用
REGISTER_ENDPOINT = "/init/add"  # 注册接口，用于首次注册或更新机器信息

# 心跳接口路径，客户端定时调用
HEARTBEAT_ENDPOINT = "/init/check"  # 心跳接口，用于定时上报状态并获取授权状态

# =============================================================================
# 心跳与重试配置
# =============================================================================

# 心跳间隔时间（秒），严格控制为15秒
HEARTBEAT_INTERVAL = 15  # 心跳发送间隔，单位：秒

# HTTP请求超时时间（秒），避免网络阻塞导致程序卡死
REQUEST_TIMEOUT = 5  # 网络请求超时时间，单位：秒，不超过3秒

# 请求失败后的最大重试次数
MAX_RETRY = 5  # 网络请求失败后的重试次数上限

# 重试间隔时间（秒）
RETRY_INTERVAL = 1  # 每次重试之间的等待时间，单位：秒

# =============================================================================
# 资源限制阈值（严格约束）
# =============================================================================

# CPU占用限制
CPU_PEAK_LIMIT = 8  # CPU峰值上限，单位：%，超过此值需要降速
CPU_AVG_LIMIT = 5  # CPU平均值上限，单位：%
CPU_THROTTLE_THRESHOLD = 7  # CPU节流阈值，超过此值主动休眠
CPU_THROTTLE_SLEEP = 0.1  # CPU超限时的休眠时间，单位：秒
CPU_SAMPLE_INTERVAL = 5  # CPU采样间隔，单位：秒

# 内存占用限制
MEMORY_PEAK_LIMIT = 300  # 内存峰值上限，单位：MB
MEMORY_RESIDENT_LIMIT = 100  # 常驻内存上限，单位：MB
MEMORY_WARNING_THRESHOLD = 280  # 内存警告阈值，超过此值释放缓存，单位：MB

# 磁盘IO限制
DISK_IO_PEAK_LIMIT = 10  # 磁盘IO峰值上限，单位：MB/s
DISK_IO_AVG_LIMIT = 1  # 磁盘IO平均上限，单位：MB/s
DISK_IO_THROTTLE_THRESHOLD = 9  # 磁盘IO节流阈值，单位：MB/s
DISK_IO_THROTTLE_SLEEP = 0.5  # 磁盘IO超限时的暂停时间，单位：秒

# =============================================================================
# 日志配置
# =============================================================================

# 单个日志文件的最大大小（字节），超过后自动切割
LOG_MAX_SIZE = 10 * 1024 * 1024  # 10MB，日志文件大小上限

# 日志文件备份数量
LOG_BACKUP_COUNT = 5  # 保留最近5个日志备份文件

# 日志写入缓冲区大小（字节）
LOG_BUFFER_SIZE = 1024  # 1KB，批量写入缓冲区大小

# 日志级别
LOG_LEVEL = "INFO"  # 默认日志级别：DEBUG, INFO, WARNING, ERROR, CRITICAL

# 日志文件名前缀
LOG_FILE_PREFIX = "client"  # 日志文件名前缀，生成格式：client.log

# =============================================================================
# 授权相关配置
# =============================================================================

# 授权状态缓存有效期（秒）
AUTH_CACHE_TTL = 300  # 5分钟，授权状态本地缓存有效期

# 离线宽限期（秒），网络不可用时允许临时运行的最长时间
OFFLINE_GRACE_PERIOD = 600  # 10分钟，离线状态下允许运行的最长时间

# =============================================================================
# 配置文件相关
# =============================================================================

# 配置文件名
CONFIG_FILE_NAME = "client_config.json"  # 配置文件名称

# 配置文件目录名（用于各平台）
CONFIG_DIR_NAME = "client_config"  # Windows: %APPDATA%/client_config
CONFIG_DIR_NAME_UNIX = ".client_config"  # Linux/macOS: ~/.client_config

# =============================================================================
# AES加密配置
# =============================================================================

# AES密钥长度（位）
AES_KEY_LENGTH = 128  # 128位AES密钥，即16字节

# AES块大小（字节）
AES_BLOCK_SIZE = 16  # AES块大小固定为16字节

# =============================================================================
# 硬件采集配置
# =============================================================================

# CPU使用率采样间隔（秒），降低CPU占用
CPU_USAGE_SAMPLE_INTERVAL = 0.5  # CPU使用率采样间隔，不超过0.5秒

# 机器码持久化文件名（UUID兜底时使用）
MACHINE_ID_FILE = ".machine_id"  # 机器码持久化文件名

# =============================================================================
# 系统兼容性配置
# =============================================================================

# 支持的最低Python版本
MIN_PYTHON_VERSION = (3, 6)  # 最低Python 3.6

# 支持的操作系统列表（用于检测和提示）
SUPPORTED_OS = {
    "Windows": ["7", "8", "10", "11", "Server 2016", "Server 2019", "Server 2022"],
    "Linux": ["Ubuntu", "CentOS", "Debian", "Fedora", "openSUSE", "UOS", "Kylin", "Deepin"],
    "Darwin": ["10.14+"]  # macOS Mojave及以上
}

# =============================================================================
# 授权状态常量
# =============================================================================

# 授权状态枚举值
AUTH_STATUS_NORMAL = "normal"  # 授权正常
AUTH_STATUS_EXPIRED = "expired"  # 授权已到期

# API响应码
RESPONSE_CODE_SUCCESS = 0  # 请求成功
RESPONSE_CODE_AUTH_EXPIRED = 1001  # 授权已到期
RESPONSE_CODE_INVALID_MACHINE = 1002  # 无效的机器码
RESPONSE_CODE_SERVER_ERROR = 5000  # 服务端内部错误

PROJECT_ID="2023031623403520002"
